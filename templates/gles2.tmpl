// Code generated by gogl; DO NOT EDIT
{{- if .Tags }}

// +build {{ .Tags }}
{{- end }}

package {{ .Package }}

/*
{{- /* Generate C stubs */}}
#cgo linux freebsd    pkg-config: glesv2
#cgo                  CFLAGS: -DGOTAG_gles2

#include "gl.h"
#include <stdio.h>

struct Version_ GLVersion;

*/
import "C"
import (
    "fmt"
    "strings"
    "unsafe"
)

// CoreProfile is true if the API was configured for the OpenGL core profile.
// This is always false if API is GLES2.
//
const CoreProfile = {{ if eq .Profile "core" }}true{{ else }}false{{ end}}

// APIVersionMajor and APIVersionMinor represent the supported API version.
// To query the runtime API version, use the Version function.
//
const (
    APIVersionMajor = {{ .Version.Major }}
    APIVersionMinor = {{ .Version.Minor }}
)

// API Values.
//
const (
    GL = iota
    GLES2
)

// API in use: GL or GLES2.
//
const (
    API = {{if eq .API "gl"}}GL{{ else }}GLES2{{ end }}
    APIString = {{if eq .API "gl"}}"GL"{{ else }}"GLES2"{{ end }}
)

// InitC initializes OpenGL. loader is a function pointer to a C function of type
//
//  typedef void *(*loader) (const char *funcName)
//
// If API is GLES2, it is safe to pass a nil pointer to this function.
//
func InitC(loader unsafe.Pointer) error {
	InitGo(nil)
    return nil
}

// InitGo initializes OpenGL. The recommended value for loader is glfw.GetProcAddress.
// The loader function must panic on error.
//
// If API is GLES2, it is safe to pass a nil pointer to this function.
//
func InitGo(loader func(string) unsafe.Pointer) {
    var (
        major = -1
        minor = -1
    )
	ver := C.GoString((*C.char)(unsafe.Pointer(C.glGetString(GL_VERSION))))
    i := strings.IndexFunc(ver, func(r rune) bool {
        return r >= '0' && r <= '9'
    })
    if i >= 0 {
        fmt.Sscanf(ver[i:], "%d.%d", &major, &minor)
    }
    if major < 0 || minor < 0 {
        panic("failed to identify OpenGLES version")
    }
    C.GLVersion.major = C.int(major)
    C.GLVersion.minor = C.int(minor)
}

// Version returns the runtime OpenGL or OpenGLES version.
//
func Version() (major, minor int) {
    return int(C.GLVersion.major), int(C.GLVersion.minor)
}

// GL Constants
//
const (
{{- range .Enums}}
	{{ .Name }} = {{ .Value }}
{{- end}}
)

// GL Functions
//

{{- range .Commands}}
{{- $ret := .Type.GoName true }}

func {{.GoName}}(
    {{- range $i, $e := .Params}}
    {{- if gt $i 0}}, {{end}}
    {{- $e.Name }} {{$e.Type.GoName false -}}
    {{- end -}}
) {{ $ret }} {
    {{if $ret}}ret := {{end -}}
    C.{{.Name}}(
        {{- range $i, $e := .Params}}
        {{- if gt $i 0}}, {{end}}
        {{- $e.Type.ToC $e.Name}}
        {{- end -}}
    )
    {{- if $ret}}
    return {{.Type.ToGo "ret"}}
    {{- end}}
}
{{- end }}
